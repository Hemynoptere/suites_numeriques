<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Suites NumÃ©riques</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', cursive; background: linear-gradient(135deg, #FFE5F0, #FFB6D9); min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .container { width: 900px; height: 650px; background: #FFE5F0; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; display: flex; flex-direction: column; }
        .header { background: #FF69B4; padding: 25px; text-align: center; }
        .header h1 { color: white; font-size: 28px; font-weight: bold; }
        .game-header { background: #FF69B4; padding: 15px 20px; display: flex; justify-content: space-between; }
        .game-header span { color: white; font-size: 16px; font-weight: bold; }
        .content { flex: 1; padding: 20px 40px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .title { color: #FF1493; font-size: 28px; font-weight: bold; margin-bottom: 40px; text-align: center; }
        .subtitle { color: #FF69B4; font-size: 20px; font-weight: bold; margin: 15px 0 20px; text-align: center; }
        .btn { font-family: 'Arial'; font-size: 16px; font-weight: bold; padding: 15px 30px; margin: 12px; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.2); color: white; width: 300px; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: #FF1493; }
        .btn-secondary { background: #FF69B4; }
        .btn-info { background: #FF85C1; }
        .btn-danger { background: #FFB6C1; }
        .btn-success { background: #32CD32; }
        .btn-warning { background: #FF6347; }
        .btn-game { background: #4169E1; }
        .btn-small { font-size: 16px; padding: 12px 24px; width: 180px; margin: 8px 5px; }
        .btn-option { font-size: 18px; padding: 18px 20px; width: 350px; margin: 12px; }
        input[type="text"] { font-family: 'Arial'; font-size: 18px; padding: 10px; width: 250px; text-align: center; border: 3px solid #FF1493; border-radius: 8px; margin: 10px; }
        .sequence-container { display: flex; justify-content: center; gap: 8px; margin: 30px 0; }
        .sequence-box { font-size: 28px; font-weight: bold; width: 100px; height: 70px; display: flex; align-items: center; justify-content: center; border-radius: 10px; border: 4px solid #2E8B57; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
        .sequence-number { background: #32CD32; color: white; }
        .sequence-input { font-family: 'Arial'; font-size: 28px; font-weight: bold; width: 100px; height: 70px; text-align: center; border: 4px solid #FF1493; border-radius: 10px; background: white; color: #FF1493; }
        .sequence-input:focus { outline: none; border-color: #FF69B4; }
        .sequence-input.correct { background: #90EE90; border-color: #32CD32; }
        .sequence-input.incorrect { background: #FFB6C1; border-color: #FF1493; }
        .explanation-box { background: #E6F3FF; border: 3px solid #4169E1; border-radius: 10px; padding: 20px; margin: 20px 0; width: 100%; max-width: 800px; min-height: 150px; max-height: 200px; overflow-y: auto; }
        .explanation-text { font-size: 14px; color: #333; line-height: 1.8; }
        .hidden { display: none; }
        .error-message { color: red; font-size: 14px; margin-top: 5px; }
        .player-list { max-height: 350px; overflow-y: auto; width: 100%; padding: 10px; }
        .player-btn { width: 100%; margin: 8px 0; padding: 15px; font-size: 14px; }
        .scores-table { background: white; border: 3px solid #FF69B4; border-radius: 10px; margin: 10px 0; width: 100%; max-height: 350px; overflow-y: auto; }
        .scores-header { background: #FF69B4; display: flex; padding: 10px; color: white; font-weight: bold; font-size: 12px; }
        .scores-row { display: flex; padding: 8px 10px; border-bottom: 1px solid #FFE5F0; font-size: 11px; }
        .scores-row:nth-child(2) { background: #FFD700; }
        .scores-row:nth-child(3) { background: #C0C0C0; }
        .scores-row:nth-child(4) { background: #CD7F32; }
        .scores-row:nth-child(n+5) { background: #FFE5F0; }
        .col-pos { width: 80px; }
        .col-name { width: 200px; font-weight: bold; }
        .col-score { width: 120px; }
        .col-games { width: 100px; }
        .button-grid { display: flex; flex-direction: column; align-items: center; margin: 10px 0; }
        .welcome-message { font-size: 32px; font-weight: bold; color: #32CD32; text-align: center; }
    </style>
</head>
<body>
    <div class="container" id="app"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        class JeuSuitesNumeriques {
            constructor() {
                this.joueurs = this.chargerJoueurs();
                this.joueurActuel = null;
                this.scorePartie = 0;
                this.suiteComplete = [];
                this.operation = '';
                this.ecart = 0;
                this.arythmique = false;
                this.niveau = '1';
                this.operationsChoisies = ['+', '-', 'x'];
                this.afficherMenuPrincipal();
            }
            chargerJoueurs() {
                const d = localStorage.getItem('joueursScores');
                return d ? JSON.parse(d) : {};
            }
            sauvegarderJoueurs() {
                localStorage.setItem('joueursScores', JSON.stringify(this.joueurs));
            }
            render(html) {
                document.getElementById('app').innerHTML = html;
            }
            afficherMenuPrincipal() {
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><button class="btn btn-primary" onclick="app.nouveauJoueur()">ğŸ® Nouveau Joueur</button><button class="btn btn-secondary" onclick="app.choisirJoueur()">ğŸ‘¤ Choisir un Joueur</button><button class="btn btn-info" onclick="app.afficherScores()">ğŸ† Voir les Scores</button><button class="btn btn-danger" onclick="window.close()">âŒ Quitter</button></div>');
            }
            nouveauJoueur() {
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">âœ¨ Nouveau Joueur âœ¨</div><div class="subtitle">Ton prÃ©nom :</div><input type="text" id="nomJoueur" placeholder="Entre ton prÃ©nom"><div class="error-message" id="errorMsg"></div><div><button class="btn btn-success btn-small" onclick="app.validerNouveauJoueur()">âœ“ Valider</button><button class="btn btn-warning btn-small" onclick="app.afficherMenuPrincipal()">â† Retour</button></div></div>');
                document.getElementById('nomJoueur').focus();
            }
            validerNouveauJoueur() {
                const nom = document.getElementById('nomJoueur').value.trim();
                if (!nom) { document.getElementById('errorMsg').textContent = 'âš ï¸ Entre ton prÃ©nom !'; return; }
                if (this.joueurs[nom]) { document.getElementById('errorMsg').textContent = 'âš ï¸ ' + nom + ' existe dÃ©jÃ  !'; return; }
                this.joueurs[nom] = { parties: 0, score_total: 0, meilleur_score: 0 };
                this.sauvegarderJoueurs();
                this.joueurActuel = nom;
                this.render('<div class="content"><div class="welcome-message">âœ¨ Bienvenue ' + nom + ' ! âœ¨</div></div>');
                setTimeout(() => this.choisirOperations(), 1500);
            }
            choisirJoueur() {
                if (Object.keys(this.joueurs).length === 0) { this.afficherMessage('Info', 'Aucun joueur enregistrÃ© !'); return; }
                let h = '';
                for (const nom in this.joueurs) {
                    const s = this.joueurs[nom];
                    h += '<button class="btn btn-secondary player-btn" onclick="app.selectionnerJoueur(\'' + nom + '\')">' + nom + '<br>' + s.parties + ' parties - ' + s.score_total + ' pts</button>';
                }
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">ğŸ‘¤ Choisis ton Profil ğŸ‘¤</div><div class="player-list">' + h + '</div><button class="btn btn-warning btn-small" onclick="app.afficherMenuPrincipal()">â† Retour</button></div>');
            }
            selectionnerJoueur(nom) {
                this.joueurActuel = nom;
                this.render('<div class="content"><div class="welcome-message">ğŸ‘‹ Bon retour ' + nom + ' ! ğŸ‘‹</div></div>');
                setTimeout(() => this.choisirOperations(), 1500);
            }
            afficherScores() {
                if (Object.keys(this.joueurs).length === 0) { this.afficherMessage('Info', 'Aucun score enregistrÃ© !'); return; }
                const sc = Object.entries(this.joueurs).sort((a, b) => b[1].score_total - a[1].score_total);
                const med = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
                let r = '';
                sc.forEach((e, i) => {
                    const nom = e[0], st = e[1], m = med[i] || '';
                    r += '<div class="scores-row"><div class="col-pos">' + m + ' ' + (i + 1) + '</div><div class="col-name">' + nom + '</div><div class="col-score">' + st.score_total + '</div><div class="col-games">' + st.parties + '</div></div>';
                });
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">ğŸ† CLASSEMENT ğŸ†</div><div class="scores-table"><div class="scores-header"><div class="col-pos">Pos.</div><div class="col-name">Joueur</div><div class="col-score">Score</div><div class="col-games">Parties</div></div>' + r + '</div><button class="btn btn-warning btn-small" onclick="app.afficherMenuPrincipal()">â† Retour</button></div>');
            }
            afficherMessage(titre, msg) {
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">' + titre + '</div><div class="subtitle" style="font-size: 18px; margin: 20px 0;">' + msg + '</div><button class="btn btn-secondary btn-small" onclick="app.afficherMenuPrincipal()">OK</button></div>');
            }
            choisirOperations() {
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">Salut ' + this.joueurActuel + ' ! ğŸŒˆ</div><div class="subtitle">ğŸ”¢ Quelle opÃ©ration ?</div><div class="button-grid"><button class="btn btn-success btn-option" onclick="app.setOperations([`+`])">â• Additions</button><button class="btn btn-warning btn-option" onclick="app.setOperations([`-`])">â– Soustractions</button><button class="btn btn-game btn-option" onclick="app.setOperations([`x`])">âœ–ï¸ Multiplications</button><button class="btn btn-secondary btn-option" onclick="app.setOperations([`+`, `-`, `x`])">ğŸ² MÃ©lange</button></div><button class="btn btn-warning btn-small" style="margin-top:15px" onclick="app.afficherMenuPrincipal()">â† Retour</button></div>');
            }
            setOperations(ops) { this.operationsChoisies = ops; this.choisirNiveau(); }
            choisirNiveau() {
                this.render('<div class="header"><h1>ğŸŒŸ SUITES NUMÃ‰RIQUES ğŸŒŸ</h1></div><div class="content"><div class="title">Salut ' + this.joueurActuel + ' ! ğŸŒˆ</div><div class="subtitle">â­ Quel niveau ?</div><div class="button-grid"><button class="btn btn-option" style="background:#228B22" onclick="app.setNiveau(`1`)">ğŸ˜Š Facile</button><button class="btn btn-option" style="background:#DAA520" onclick="app.setNiveau(`2`)">ğŸ˜ Moyen</button><button class="btn btn-option" style="background:#FF8C00" onclick="app.setNiveau(`3`)">ğŸ”¥ Difficile</button><button class="btn btn-option" style="background:#DC143C" onclick="app.setNiveau(`4`)">ğŸ’ª TrÃ¨s Difficile</button></div><button class="btn btn-warning btn-small" style="margin-top:15px" onclick="app.choisirOperations()">â† Retour</button></div>');
            }
            setNiveau(n) { this.niveau = n; this.scorePartie = 0; this.genererNouvelleSuite(); }
            genererSuite() {
                const op = this.operationsChoisies[Math.floor(Math.random() * this.operationsChoisies.length)];
                let d, e, lm;
                if (this.niveau === '1') {
                    lm = 50; d = op === '+' ? Math.floor(Math.random() * 30) + 1 : op === '-' ? Math.floor(Math.random() * 31) + 20 : Math.floor(Math.random() * 5) + 1;
                    e = op === 'x' ? Math.floor(Math.random() * 2) + 2 : Math.floor(Math.random() * 5) + 1;
                } else if (this.niveau === '2') {
                    lm = 100; d = op === '+' ? Math.floor(Math.random() * 60) + 1 : op === '-' ? Math.floor(Math.random() * 61) + 40 : Math.floor(Math.random() * 10) + 1;
                    e = op === 'x' ? Math.floor(Math.random() * 3) + 2 : Math.floor(Math.random() * 10) + 1;
                } else if (this.niveau === '3') {
                    lm = 500; d = op === '+' ? Math.floor(Math.random() * 300) + 1 : op === '-' ? Math.floor(Math.random() * 301) + 200 : Math.floor(Math.random() * 20) + 1;
                    e = op === 'x' ? Math.floor(Math.random() * 4) + 2 : Math.floor(Math.random() * 16) + 5;
                } else {
                    lm = 500;
                    const e1 = Math.floor(Math.random() * 15) + 1, e2 = Math.floor(Math.random() * 15) + 1;
                    d = op === '+' ? Math.floor(Math.random() * 300) + 1 : op === '-' ? Math.floor(Math.random() * 301) + 200 : Math.floor(Math.random() * 15) + 1;
                    const su = [d], es = [e1, e2];
                    for (let i = 0; i < 6; i++) {
                        const ea = es[i % 2];
                        let p = op === '+' ? su[su.length - 1] + ea : op === '-' ? su[su.length - 1] - ea : su[su.length - 1] * ea;
                        if (p < 0 || p > lm) return this.genererSuite();
                        su.push(p);
                    }
                    return { suite: su, operation: op, ecart: [e1, e2], arythmique: true };
                }
                const su = [d];
                for (let i = 0; i < 6; i++) {
                    let p = op === '+' ? su[su.length - 1] + e : op === '-' ? su[su.length - 1] - e : su[su.length - 1] * e;
                    if (p < 0 || p > lm) return this.genererSuite();
                    su.push(p);
                }
                return { suite: su, operation: op, ecart: e, arythmique: false };
            }
            genererNouvelleSuite() {
                const r = this.genererSuite();
                this.suiteComplete = r.suite; this.operation = r.operation; this.ecart = r.ecart; this.arythmique = r.arythmique;
                this.afficherJeu();
            }
            afficherJeu() {
                let nh = '', ih = '';
                for (let i = 0; i < 3; i++) nh += '<div class="sequence-box sequence-number">' + this.suiteComplete[i] + '</div>';
                for (let i = 0; i < 4; i++) ih += '<input type="number" class="sequence-input" id="input' + i + '">';
                this.render('<div class="game-header"><span>Joueur: ' + this.joueurActuel + '</span><span id="scoreDisplay">â­ Score: ' + this.scorePartie + '</span></div><div class="content"><div class="title" style="font-size:24px;margin-bottom:20px">ğŸ¯ ComplÃ¨te la suite ğŸ¯</div><div class="sequence-container">' + nh + ih + '</div><div class="explanation-box hidden" id="explanationBox"><div class="explanation-text" id="explanation"></div></div><div><button class="btn btn-success btn-small" onclick="app.verifierReponses()">âœ“ VÃ©rifier</button><button class="btn btn-game btn-small" onclick="app.genererNouvelleSuite()">ğŸ”„ Nouvelle</button><button class="btn btn-warning btn-small" onclick="app.terminerPartie()">ğŸ Terminer</button></div></div>');
                document.getElementById('input0').focus();
            }
            verifierReponses() {
                const rep = [], inp = [];
                for (let i = 0; i < 4; i++) inp.push(document.getElementById('input' + i));
                for (let i = 0; i < inp.length; i++) {
                    const v = parseInt(inp[i].value);
                    if (isNaN(v)) { alert('âš ï¸ Remplis tous les champs !'); return; }
                    rep.push(v);
                }
                let br = 0, msg = '<strong>ğŸ¯ RÃ‰SULTATS :</strong><br><br>';
                for (let i = 0; i < rep.length; i++) {
                    const r = rep[i], c = this.suiteComplete[3 + i];
                    if (r === c) {
                        msg += 'âœ“ Nombre ' + (i + 1) + ' : CORRECT !<br>';
                        inp[i].classList.add('correct'); br++;
                    } else {
                        msg += 'âœ— Nombre ' + (i + 1) + ' : FAUX (c\'Ã©tait ' + c + ')<br>';
                        inp[i].classList.add('incorrect');
                    }
                }
                this.scorePartie += br;
                msg += '<br><strong>ğŸ’¡ EXPLICATION :</strong><br>';
                msg += this.arythmique ? 'Suite arythmique alternant ' + this.operation + ' ' + this.ecart[0] + ' et ' + this.operation + ' ' + this.ecart[1] : 'Chaque nombre ' + this.operation + ' ' + this.ecart;
                msg += '<br><br><strong>ğŸ“‹ Suite complÃ¨te :</strong><br>' + this.suiteComplete.join(' - ');
                msg += '<br><br><strong>â­ Score de la partie :</strong> ' + this.scorePartie + ' points';
                if (br === 4) msg = '<strong style="color:#008000;font-size:18px">ğŸ‰ PARFAIT ! ğŸ‰</strong><br><br>' + msg;
                document.getElementById('explanation').innerHTML = msg;
                document.getElementById('explanationBox').classList.remove('hidden');
                document.getElementById('scoreDisplay').textContent = 'â­ Score: ' + this.scorePartie;
            }
            terminerPartie() {
                if (this.scorePartie > 0) {
                    this.joueurs[this.joueurActuel].parties++;
                    this.joueurs[this.joueurActuel].score_total += this.scorePartie;
                    if (this.scorePartie > this.joueurs[this.joueurActuel].meilleur_score) this.joueurs[this.joueurActuel].meilleur_score = this.scorePartie;
                    this.sauvegarderJoueurs();
                    const m = 'Partie terminÃ©e !<br><br>Score final : ' + this.scorePartie + ' points<br><br>Score total de ' + this.joueurActuel + ' : ' + this.joueurs[this.joueurActuel].score_total + ' points';
                    this.render('<div class="content"><div class="title">ğŸ‰ Bravo ! ğŸ‰</div><div class="subtitle" style="font-size:16px;margin:20px;line-height:2">' + m + '</div><button class="btn btn-secondary btn-small" onclick="app.afficherMenuPrincipal()">OK</button></div>');
                } else this.afficherMenuPrincipal();
            }
        }
        const app = new JeuSuitesNumeriques();
    </script>
</body>
</html>
